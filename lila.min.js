const componentStores=new Map,registeredComponents=new Map,activeComponentInstances=new Set;function getRegisteredComponents(e){return registeredComponents.get(e)}function reactive(e,t=!1){let n=new Set;return t&&n.add(t),new Proxy(e,{set:(e,t,o)=>(e[t]!==o&&(e[t]=o,n.forEach((e=>e(t,o)))),!0),get(e,t){if("subscribe"===t)return e=>(n.add(e),()=>n.delete(e));let o=e[t];return"function"==typeof o&&Array.isArray(e)&&["push","pop","shift","unshift","splice","sort","reverse"].includes(t)?function(...t){let r=o.apply(e,t);return n.forEach((t=>t("items",e))),r}:o}})}function createComponent(e,{template:t,state:n,actions:o,onMount:r,onDestroy:a}){let i="string"==typeof t?compileTemplate(t):t;return registeredComponents.set(e,{template:i,state:n||(()=>({})),actions:o||{},onMount:r,onDestroy:a}),registeredComponents.get(e)}function evalInContext(e,t){try{let n=Object.keys(t),o=Object.values(t);return new Function(...n,`return ${e}`)(...o)}catch(t){return void console.error(`Error evaluating expression: "${e}"`,t)}}function mountComponent(e,t,n={}){let o=document.getElementById(t);if(!o)return console.error(`Target element with id "${t}" not found.`),null;let r=registeredComponents.get(e);if(!r)return console.error(`Component "${e}" not found.`),null;let a=reactive(r.state(n)),i=new Map,l=new Map,c=!1;const s=document.createDocumentFragment();for(;o.firstChild;)s.appendChild(o.firstChild);function d(e){const t=new Set(["true","false","null","undefined","this"]);return[...new Set((e.match(/[a-zA-Z_$][a-zA-Z0-9_$]*/g)||[]).filter((e=>!t.has(e))))]}function u(e,t,n){let o=e.getAttribute("data-repeat"),r=evalInContext(o,{...t,...n}),a=e.parentNode,i=e.nextElementSibling;for(;i;){let e=i;if(i=e.nextElementSibling,!e||!e.hasAttribute("data-repeated-item"))break;a.removeChild(e)}let l=document.createDocumentFragment(),c=e.firstElementChild;if(!c)return console.warn(`data-repeat element "[data-repeat="${o}"]" has no child element to use as a template.`),void(e.style.display="none");Array.isArray(r)?r.forEach(((e,o)=>{let r=c.cloneNode(!0);r.setAttribute("data-repeated-item",""),r.querySelectorAll("[data-repeat-if]").forEach((r=>{let a=r.getAttribute("data-repeat-if"),i=d(a),l=evalInContext(a,{...t,...n,item:e,index:o});r.style.display=l?"":"none",i.includes("item")&&(l=evalInContext(a,{...t,...n,item:e,index:o}),r.style.display=l?"":"none")})),r.querySelectorAll("*").forEach((n=>{Array.from(n.attributes).filter((e=>e.name.startsWith("data-repeat-bind-html-"))).forEach((r=>{const a=r.name.replace("data-repeat-bind-html-",""),i=evalInContext(r.value,{...t,item:e,index:o});null!=i&&n.setAttribute(a,i)}))})),Array.from(r.querySelectorAll("[data-repeat-bind]")).forEach((n=>{const r=n.getAttribute("data-repeat-bind");if(r){const a=evalInContext(r,{...t,item:e,index:o});void 0!==a&&(n.textContent=a)}Array.from(n.attributes).forEach((r=>{if(r.name.startsWith("data-repeat-bind:")){const a=r.name.split(":")[1],i=evalInContext(r.value,{...t,item:e,index:o});void 0!==i&&n.setAttribute(a,i)}}))})),r.querySelectorAll("[data-repeat-action]").forEach((r=>{let a=r.getAttribute("data-repeat-action");if(n[a]){let i=r=>{r.preventDefault(),n[a]({state:t,event:r,item:e,index:o})};r.addEventListener("click",i),r._actionListener=i}else console.warn(`Action "${a}" not found for data-repeat-action`)})),l.appendChild(r)})):console.warn(`data-repeat expression "${o}" did not evaluate to an array. Result:`,r),a.insertBefore(l,e.nextSibling),e.style.display="none"}function p(e=[]){!c&&o&&(c=!0,requestAnimationFrame((()=>{try{if(0===e.length){i.forEach((({listener:e,eventType:t},n)=>{n&&e&&n.removeEventListener(t,e)})),i.clear(),o.querySelectorAll("[data-action]").forEach((e=>{if(e._actionListener){let t="FORM"===e.tagName?"submit":"click";e.removeEventListener(t,e._actionListener),delete e._actionListener}})),l.forEach(((e,t)=>{try{e.destroy()}catch(e){console.error("Error destroying nested component during update:",e)}t&&delete t._componentInstance})),l.clear();let e=r.template({...a,...r.actions});if("string"==typeof e){o.innerHTML=e;const t=o.querySelector("slot");t&&s.hasChildNodes()&&t.parentNode.replaceChild(s,t),o.querySelectorAll("[data-if]").forEach((e=>{let t=evalInContext(e.getAttribute("data-if"),{...a,...r.actions});e.style.display=t?"":"none"})),o.querySelectorAll("[data-else]").forEach((e=>{let t=evalInContext(e.getAttribute("data-else"),{...a,...r.actions});e.style.display=t?"none":""})),o.querySelectorAll("[data-repeat]").forEach((e=>{u(e,a,r.actions)})),o.querySelectorAll("[data-component]").forEach((e=>{let t=e.id||(()=>{let t="lila-"+Math.random().toString(36).substr(2,9);for(;document.getElementById(t);)t="lila-"+Math.random().toString(36).substr(2,9);return e.id=t,t})();if(e.id=t,!e._componentInstance){let n=e.dataset.component;const o={};for(const e in r.actions)"function"==typeof r.actions[e]&&(o[e]=(...t)=>r.actions[e]({state:a,actions:r.actions,...t[0]}));const i={...evalInContext(e.dataset.props||"{}",{...a,...r.actions}),_parentActions:o,_parentState:a};"DialogSearch"==n&&console.log(`Mounting nested component ${n}: passing props`,i);let c=mountComponent(n,t,i);c&&(l.set(e,c),e._componentInstance=c)}})),o.querySelectorAll("[data-action]").forEach((e=>{let t=e.dataset.action;if(r.actions[t]&&!e._actionListener){let n=n=>{"FORM"===e.tagName&&n.preventDefault(),r.actions[t]({state:a,event:n})},o="FORM"===e.tagName?"submit":"click";e.addEventListener(o,n),e._actionListener=n}else r.actions[t]||console.warn(`Action "${t}" not found for data-action`)})),o.querySelectorAll("[data-model]").forEach((e=>{let t=e.getAttribute("data-model");if(void 0!==a[t]&&("checkbox"===e.type||"radio"===e.type?e.checked=a[t]:e.value=a[t]),!i.has(e)){let n="checkbox"===e.type||"radio"===e.type?"change":"input",o=n=>{c||("checkbox"===e.type?a[t]=n.target.checked:"radio"===e.type?n.target.checked&&(a[t]=n.target.value):a[t]=n.target.value)};e.addEventListener(n,o),i.set(e,{property:t,listener:o,eventType:n})}})),o.querySelectorAll("[data-bind]").forEach((e=>{let t=e.getAttribute("data-bind");void 0!==a[t]&&(e.textContent=a[t])}))}else console.error("Component template did not return a string.")}else e.forEach((e=>{o.querySelectorAll(`[data-bind="${e}"]`).forEach((t=>{void 0!==a[e]&&(t.textContent=a[e])})),o.querySelectorAll(`[data-model="${e}"]`).forEach((t=>{t!==document.activeElement&&void 0!==a[e]&&("checkbox"===t.type||"radio"===t.type?t.checked!==a[e]&&(t.checked=a[e]):t.value!==a[e]&&(t.value=a[e]))})),o.querySelectorAll("[data-if]").forEach((t=>{let n=t.getAttribute("data-if");if(d(n).includes(e)){let e=evalInContext(n,{...a,...r.actions});t.style.display=e?"":"none"}})),o.querySelectorAll("[data-else]").forEach((t=>{let n=t.getAttribute("data-else");if(d(n).includes(e)){let e=evalInContext(n,{...a,...r.actions});t.style.display=e?"none":""}})),o.querySelectorAll("[data-repeat]").forEach((t=>{d(t.getAttribute("data-repeat")).includes(e)&&u(t,a,r.actions)}))}))}catch(e){console.error("Error during update:",e)}finally{c=!1}})))}let m=a.subscribe((e=>{p([e])}));setTimeout((()=>{if(p(),r.onMount)try{let e=r.onMount(a);e&&"function"==typeof e.then?e.then((()=>{p()})).catch((e=>console.error("Error in onMount promise:",e))):p()}catch(e){console.error("Error in onMount:",e)}}),0);let f={destroy(){try{r.onDestroy&&r.onDestroy(a)}catch(e){console.error("Error in onDestroy:",e)}l.forEach(((e,t)=>{try{e.destroy(),t&&delete t._componentInstance}catch(e){console.error("Error destroying nested component:",e)}})),l.clear(),m(),i.forEach((({listener:e,eventType:t},n)=>{n&&e&&n.removeEventListener(t,e)})),i.clear(),o&&(o.querySelectorAll("[data-action]").forEach((e=>{if(e._actionListener){let t="FORM"===e.tagName?"submit":"click";e.removeEventListener(t,e._actionListener),delete e._actionListener}})),o.innerHTML="")},state:a,forceUpdate(){p()}};return activeComponentInstances.add(f),f}function handleRouting(){let e=window.location.hash.substring(1)||"/",t=routes.get(e)||routes.get("*");t?(activeComponentInstances.forEach((e=>{try{e.destroy()}catch(e){console.error("Error destroying instance during routing:",e)}})),activeComponentInstances.clear(),document.getElementById("app-lila")?mountComponent(t.componentName,"app-lila",t.props):console.error('App outlet element with id "app-lila" not found.')):console.warn(`No route found for path: "${e}"`)}const routes=new Map;function addRoute(e,t,n={}){routes.set(e,{componentName:t,props:n})}function navigateTo(e){window.location.hash.substring(1)!==e&&(window.location.hash=e)}function compileTemplate(e){let t=document.querySelector(`[data-template="${e}"]`);if(!t)return console.error(`Template element with data-template="${e}" not found.`),()=>"";let n=t.innerHTML;return e=>n.replace(/\${([^}]+)}/g,((t,n)=>{try{return evalInContext(n.trim(),e)}catch(e){return console.error(`Error evaluating template expression: "${n}"`,e),`Error: ${n}`}}))}window.addEventListener("hashchange",handleRouting),window.addEventListener("load",handleRouting),document.addEventListener("click",(e=>{let t=e.target.closest("[data-link]");if(t){e.preventDefault();let n=t.getAttribute("href");n&&navigateTo(n)}})),window.App={reactive:reactive,createComponent:createComponent,addRoute:addRoute,navigateTo:navigateTo,mountComponent:mountComponent,getComponents:getRegisteredComponents,evalInContext:evalInContext};
